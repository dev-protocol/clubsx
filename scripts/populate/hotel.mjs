import { encode, decode } from '@devprotocol/clubs-core'
import { db } from './utils/db.mjs'
import { whenCalledDirectly } from './utils/whenCalledDirectly.mjs'
import jsonwebtoken from 'jsonwebtoken'

const KEY = 'hotel'

const { SALT } = process.env

const populate = async (client) => {
  const base = decode(await client.get(KEY))
  const ticketWebhook = jsonwebtoken.sign(
    `https://clubs-userland-template.vercel.app/api/webhooks/tickets/template/dest/airtable/tbley5joim77xMPaR`,
    SALT,
  )

  await client.set(
    KEY,
    encode({
      ...base,
      plugins: [
        ...base.plugins.filter(
          ({ id }) =>
            id !== 'devprotocol:clubs:plugin:clubs-payments' &&
            id !== 'devprotocol:clubs:plugin:tickets',
        ),
        {
          id: 'devprotocol:clubs:plugin:clubs-payments',
          name: 'fiat',
          enable: true,
          options: [
            {
              key: 'override',
              value: [
                {
                  id: '----------2',
                  importFrom: 'devprotocol:clubs:simple-memberships',
                  key: 'memberships',
                  payload:
                    '0x98358cf2bb54ee7a29f874ca838f268c2a2c8dd7f419e7dd8023d97d643e907b',
                  price: {
                    yen: 3500,
                  },
                },
                {
                  id: '---------',
                  importFrom: 'devprotocol:clubs:simple-memberships',
                  key: 'memberships',
                  payload:
                    '0x4ceadd28ce51f2e255a42171ec6d6b44942a5556eddddc1478693f0ea1c7ad7b',
                  price: {
                    yen: 1200,
                  },
                },
                {
                  id: '-------1----2',
                  importFrom: 'devprotocol:clubs:simple-memberships',
                  key: 'memberships',
                  payload:
                    '0x0589b5a6b000a6f19d9d41f5a2a90b7db9f4428d8b9210d7163328e0989c7bd0',
                  price: {
                    yen: 30000,
                  },
                },
              ],
            },
          ],
        },
        {
          id: 'devprotocol:clubs:plugin:tickets',
          options: [
            {
              key: 'tickets',
              value: [
                {
                  payload:
                    '0x98358cf2bb54ee7a29f874ca838f268c2a2c8dd7f419e7dd8023d97d643e907b',
                  importedFrom: {
                    plugin: 'devprotocol:clubs:simple-memberships',
                    key: 'memberships',
                  },
                  name: '„É¢„Éº„Éã„É≥„Ç∞„ÉÅ„Ç±„ÉÉ„Éà',
                  uses: [
                    {
                      id: 'morning',
                      name: '„É¢„Éº„Éã„É≥„Ç∞„ÉÅ„Ç±„ÉÉ„Éà',
                      description:
                        'Â≠£ÁØÄ„ÅÆÈ£üÊùê„ÇíÁî®„ÅÑ„Åü„Çµ„É©„ÉÄ„ÄÅ„Åì„Å†„Çè„Çä„ÅÆ„Éë„É≥„ÇÑ„Çπ„Ç§„Éº„ÉÑ„Çí„ÅäÂ•Ω„Åç„Å™„Å†„Åë„ÅäÊ•Ω„Åó„ÅøÈ†Ç„Åë„Åæ„Åô„ÄÇ',
                      duration: '1 days',
                      within: '1 months',
                      availability: [
                        {
                          type: 'weekday-time',
                          weekday: 1,
                          start: '7 hour',
                          end: '10 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 2,
                          start: '7 hour',
                          end: '10 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 3,
                          start: '7 hour',
                          end: '10 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 4,
                          start: '7 hour',
                          end: '10 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 5,
                          start: '7 hour',
                          end: '10 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 6,
                          start: '7 hour',
                          end: '11 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 7,
                          start: '7 hour',
                          end: '11 hour',
                          tz: 'Asia/Tokyo',
                        },
                      ],
                      refreshCycle: undefined,
                    },
                  ],
                  webhooks: {
                    used: {
                      encrypted: ticketWebhook,
                    },
                  },
                },
                {
                  payload:
                    '0x4ceadd28ce51f2e255a42171ec6d6b44942a5556eddddc1478693f0ea1c7ad7b',
                  importedFrom: {
                    plugin: 'devprotocol:clubs:simple-memberships',
                    key: 'memberships',
                  },
                  name: 'ÂêçÁâ©„É©„ÉÜ„Ç¢„Éº„Éà‚òïÔ∏è',
                  uses: [
                    {
                      id: 'latte-art',
                      name: 'ÂêçÁâ©„É©„ÉÜ„Ç¢„Éº„Éà‚òïÔ∏è',
                      description:
                        'Ë¶ã„ÅüÁõÆ„ÇÇÊ•Ω„Åó„ÇÅ„Çã„ÄÅÂ§ß‰∫∫Ê∞ó„ÅÆ„É©„ÉÜ„Ç¢„Éº„Éà„Åß„Åô„ÄÇ„Éö„ÉÉ„Éà„ÅÆÂÜôÁúü„ÇíË¶ã„Åõ„Å¶È†Ç„Åë„Çå„Å∞„ÄÅ„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„ÇÇÂá∫Êù•„Åæ„Åôüê∂üê±ü¶ú',
                      duration: '1 days',
                      within: '1 months',
                      availability: [
                        {
                          type: 'weekday-time',
                          weekday: 1,
                          start: '11 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 2,
                          start: '11 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 3,
                          start: '11 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 4,
                          start: '11 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 5,
                          start: '11 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 6,
                          start: '11 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 7,
                          start: '11 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                      ],
                      refreshCycle: undefined,
                    },
                  ],
                  webhooks: {
                    used: {
                      encrypted: ticketWebhook,
                    },
                  },
                },
                {
                  payload:
                    '0x0589b5a6b000a6f19d9d41f5a2a90b7db9f4428d8b9210d7163328e0989c7bd0',
                  importedFrom: {
                    plugin: 'devprotocol:clubs:simple-memberships',
                    key: 'memberships',
                  },
                  name: '„É©„Ç¶„É≥„Ç∏‰ºöÂì°„Ää1ÈÄ±Èñì„Äã',
                  uses: [
                    {
                      id: 'one-week-access',
                      name: '„É©„Ç¶„É≥„Ç∏‰ºöÂì°„Ää1ÈÄ±Èñì„Äã',
                      description:
                        '„Éõ„ÉÜ„É´1Èöé„Å´„ÅÇ„Çã„É©„Ç¶„É≥„Ç∏„Çí1ÈÄ±Èñì„ÄÅ„ÅîÂà©Áî®È†Ç„Åë„Åæ„Åô„ÄÇ„ÅäÈ£≤„ÅøÁâ©„ÇÑËªΩÈ£ü„Çí„ÅîÁî®ÊÑè„Åó„Å¶„Åä„Çä„Åæ„Åô„ÅÆ„Åß„ÄÅÈï∑ÊúüÊªûÂú®‰∏≠„ÅÆ„Åä‰ªï‰∫ã„ÇÑ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅÆÂ†¥„Å®„Åó„Å¶„ÅäÈÅé„Åî„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ',
                      duration: '1 weeks',
                      within: '1 months',
                      availability: [
                        {
                          type: 'weekday-time',
                          weekday: 1,
                          start: '7 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 2,
                          start: '7 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 3,
                          start: '7 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 4,
                          start: '7 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 5,
                          start: '7 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 6,
                          start: '7 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                        {
                          type: 'weekday-time',
                          weekday: 7,
                          start: '7 hour',
                          end: '21 hour',
                          tz: 'Asia/Tokyo',
                        },
                      ],
                      refreshCycle: undefined,
                    },
                  ],
                  webhooks: {
                    used: {
                      encrypted: ticketWebhook,
                    },
                  },
                },
              ],
            },
          ],
        },
      ],
    }),
  )

  console.log('set', KEY)
}

whenCalledDirectly(async () => {
  const client = await db()
  await populate(client)
  await client.quit()
})

export default populate
